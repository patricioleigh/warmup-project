name: CI

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  backend-tests:
    name: Backend Tests
    uses: ./.github/workflows/backend-tests.yml

  frontend-tests:
    name: Frontend Tests
    uses: ./.github/workflows/frontend-tests.yml

  docker-integration:
    name: Docker Integration
    uses: ./.github/workflows/docker-integration.yml
    needs: [backend-tests, frontend-tests]

  quality-gate:
    name: Quality Gate
    runs-on: ubuntu-latest
    needs: [backend-tests, frontend-tests, docker-integration]
    if: always()
    
    steps:
      - name: Check test results
        run: |
          if [ "${{ needs.backend-tests.result }}" != "success" ]; then
            echo "❌ Backend tests failed"
            exit 1
          fi
          
          if [ "${{ needs.frontend-tests.result }}" != "success" ]; then
            echo "❌ Frontend tests failed"
            exit 1
          fi
          
          if [ "${{ needs.docker-integration.result }}" != "success" ]; then
            echo "❌ Docker integration tests failed"
            exit 1
          fi
          
          echo "✅ All tests passed successfully!"
